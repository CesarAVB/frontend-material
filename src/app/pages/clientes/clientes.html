<!-- src/app/pages/clientes/clientes.component.html -->
<app-header 
  titulo="Listagem de Clientes" 
  subtitulo="Gerencie as informações e status dos seus clientes cadastrados."
  [mostrarBotaoNovo]="true">
</app-header>

<div class="clientes-container">
  <!-- Barra de Busca e Filtros -->
  <mat-card class="search-card">
    <mat-card-content>
      <div class="search-row">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar</mat-label>
          <input 
            matInput 
            (keyup)="aplicarFiltro($event)" 
            placeholder="Buscar por Nome, CPF ou Email">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <button 
          mat-raised-button 
          (click)="toggleFiltros()"
          class="btn-filtros">
          <mat-icon>filter_list</mat-icon>
          <span>Filtros</span>
        </button>
      </div>

      <!-- Painel de Filtros -->
      @if (mostrarFiltros()) {
        <div class="filtros-panel">
          <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select [(value)]="filtroStatus">
              <mat-option value="todos">Todos</mat-option>
              <mat-option value="ativo">Ativo</mat-option>
              <mat-option value="pendente">Pendente</mat-option>
              <mat-option value="inativo">Inativo</mat-option>
              <mat-option value="bloqueado">Bloqueado</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Tipo de Pessoa</mat-label>
            <mat-select [(value)]="filtroTipoPessoa">
              <mat-option value="todos">Todos</mat-option>
              <mat-option value="FISICA">Pessoa Física</mat-option>
              <mat-option value="JURIDICA">Pessoa Jurídica</mat-option>
            </mat-select>
          </mat-form-field>

          <button mat-raised-button color="warn">
            Limpar Filtros
          </button>
        </div>
      }
    </mat-card-content>
  </mat-card>

  <!-- Tabela -->
  <mat-card class="table-card">
    @if (!carregando()) {
      <table mat-table [dataSource]="dataSource" matSort class="clientes-table">
        
        <!-- Coluna Nome -->
        <ng-container matColumnDef="nome">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Nome</th>
          <td mat-cell *matCellDef="let cliente">
            <div class="cliente-info">
              <app-avatar [name]="cliente.nome" size="md"></app-avatar>
              <div class="cliente-detalhes">
                <span class="cliente-nome">{{ cliente.nome }}</span>
                <span class="cliente-id">ID: #C{{ cliente.id.toString().padStart(3, '0') }}</span>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Coluna CPF/CNPJ -->
        <ng-container matColumnDef="cpfCnpj">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>CPF/CNPJ</th>
          <td mat-cell *matCellDef="let cliente">
            {{ formatarCpfCnpj(cliente.cpfCnpj) }}
          </td>
        </ng-container>

        <!-- Coluna Email -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let cliente">
            <div class="contato-item">
              <mat-icon class="contato-icon">email</mat-icon>
              <span>{{ getEmail(cliente) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Coluna Telefone -->
        <ng-container matColumnDef="telefone">
          <th mat-header-cell *matHeaderCellDef>Telefone</th>
          <td mat-cell *matCellDef="let cliente">
            <div class="contato-item">
              <mat-icon class="contato-icon">phone</mat-icon>
              <span>{{ getTelefone(cliente) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Coluna Status -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let cliente">
            <app-status-badge [status]="getStatus(cliente)"></app-status-badge>
          </td>
        </ng-container>

        <!-- Coluna Ações -->
        <ng-container matColumnDef="acoes">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let cliente">
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="menu"
              [matMenuTriggerData]="{cliente: cliente}">
              <mat-icon>more_vert</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <!-- Linha quando não há dados -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">
            <div class="empty-state">
              <mat-icon>inbox</mat-icon>
              <p>Nenhum cliente encontrado</p>
              <button mat-raised-button color="primary" (click)="novoCliente()">
                Cadastrar Primeiro Cliente
              </button>
            </div>
          </td>
        </tr>
      </table>

      <mat-paginator 
        [pageSizeOptions]="[5, 10, 25, 100]"
        showFirstLastButtons>
      </mat-paginator>
    }

    @if (carregando()) {
      <div class="loading-state">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Carregando clientes...</p>
      </div>
    }

    @if (erro()) {
      <div class="error-state">
        <mat-icon>error</mat-icon>
        <p>{{ erro() }}</p>
        <button mat-raised-button color="primary" (click)="carregarClientes()">
          Tentar novamente
        </button>
      </div>
    }
  </mat-card>
</div>

<!-- Menu de Ações -->
<mat-menu #menu="matMenu">
  <ng-template matMenuContent let-cliente="cliente">
    <button mat-menu-item (click)="visualizar(cliente)">
      <mat-icon>visibility</mat-icon>
      <span>Visualizar</span>
    </button>
    <button mat-menu-item (click)="editar(cliente)">
      <mat-icon>edit</mat-icon>
      <span>Editar</span>
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="excluir(cliente)" class="delete-item">
      <mat-icon>delete</mat-icon>
      <span>Excluir</span>
    </button>
  </ng-template>
</mat-menu>